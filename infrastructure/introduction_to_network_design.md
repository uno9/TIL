# ネットワーク設計入門
作成日時:2022/03/11

## 1.AWSリソースが稼働している場所
* Amazon Virtual Private Cloudの場合
  * 16のリージョン
  * 42のアベイラビリティゾーンで構成
    * VPCは、アベイラビリティゾーン内で稼働

## 2.ネットワークでの分類
* プライベートIPアドレス空間で稼働するリソース
  * EC2
  * RDS
  * EMRなど
* パブリックIPアドレス空間で稼働するリソース
  * S3
  * Lambda
  * DynamoDB
  * CloudWatchなど

## 3.プライベートサブネットの設計
1. VPCの作成
2. サブネットの作成
3. VPCコンポーネントの配置とルーティング設定
4. インスタンスの配置
5. 名前解決の検討

### VPCの作成
- 使用するCIDRブロックを決める
  - /28~/16
  - > レンジはRFC1918を推奨
    - VPCのレンジを設定するときに、参考になりそうな[記事](https://dev.classmethod.jp/articles/amazon-vpc-5-tips/)
      - AWS上では、5つの予約CIDRがあるため、[設定したいレンジ ー 5]で考える
    - 作成後は、レンジを変更することができないため、大きめに作成することを推奨（`/16`など）
- 他のサービスのCIDRとは異なるものを使用する
  - 相互接続をおこなう際に、同じCIDRだと一部機能がしようできない(VPCpeeringなど)ため、注意すること
  - オンプレ、他のVPCなどのCIDRは要確認

### サブネットの作成
- VPCのCIDRのレンジをもとに、サブネットで使用するIPレンジを設定する
  - 必要なIPアドレス数で見積もる（`/24`で設定することが多い）
  - 要件に応じて、サブネットの分割を検討する
    - インターネットからアクセスがある場合、機密情報が見えない用に、パブリックサブネットでインターネットとの通信をやりとりし、プライベートサブネットで情報を管理する
  - サブネットはAZの中に作成される
    - どの拠点からアクセスするか（アクセスされる場所を想定して、どの拠点にリソースを作成すると遅延が少ないか検討する）
    - サブネットが作成されているアベイラビリティゾーンで障害が発生したことを見越してサブネットを作成する
      - サービスの可用性を考えると、複数のアベイラビリティゾーンにサブネットを作成しておくことが望ましい（最低2個以上）

### VPCコンポーネントの配置とルーティング設定
- VPCの中にVPC環境で使用することができるリソースを設置
 - VPC単位で配置するコンポーネント例
   - インターネットゲートウェイ
   - VPCエンドポイント
   - VPCピア接続
 - サブネット単位で配置するコンポーネント例
   - VPCルータ
   - NATゲートウェイ
 - インスタンス単位で配置するコンポーネント例
   - EIP
- 設置したコンポーネントへ通信を行うルートを設定する
 - IGWのルートを作成
 - メインのルートは、デフォルトで生成される

### インスタンスの配置
- サブネット、インスタンスのセキュリティポリシーを設定
  - ネットワークACLの作成
  - セキュリティグループの作成
    - ネットワークACLとセキュリティグループの違い
      - 優先度や何に対してセキュリティ管理をするのか、対象が異なる
    - https://docs.aws.amazon.com/ja_jp/vpc/latest/userguide/VPC_Security.html
- インスタンスを配置
  - プライベートIPアドレスは自動で割り当てられる
  - インターネットに接続するインスタンスには、パブリックIPアドレスを割り当てる
    - 動的にパブリックIPアドレスを割り当てるものと固定IPアドレス(EIP)を付与するものがある
  - プライベートIPとパブリックIPの違い参考記事: https://rainbow-engine.com/publicip-privateip-difference/

### 名前解決の検討
- DNS名を指定するか？

## 参考にした記事
- [AWS のネットワーク設計入門](https://d1.awsstatic.com/events/jp/2017/summit/slide/D2T3-5.pdf)
